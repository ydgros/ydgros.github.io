<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>ffmpeg命令 | 园丁的小站</title>

<link rel="shortcut icon" href="https://ydgros.github.io/favicon.ico?v=1654498012719">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://ydgros.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            园丁的小站
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            标签
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1654498012719" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    ffmpeg命令
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-05-04 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <h1 id="ffmpeg">ffmpeg</h1>
<h2 id="常用命令">常用命令</h2>
<h3 id="01下载配置">01.下载，配置</h3>
<p>用的系统是Ubuntu18.04,所以直接apt-get就可以了</p>
<pre><code class="language-shell">sudo apt-get install ffmpeg
</code></pre>
<pre><code class="language-shell">https://ffmpeg.org/
</code></pre>
<pre><code class="language-shell">https://github.com/BtbN/FFmpeg-Builds
</code></pre>
<h3 id="02简介上手ffmpeg-ffprobe-ffplay">02.简介，上手(FFmpeg FFprobe FFplay)</h3>
<p>(1)查看ffmpeg的帮助说明，提供的指令</p>
<pre><code class="language-shell">ffmpeg -h
</code></pre>
<p>(2)播放媒体的指令</p>
<pre><code class="language-shell">ffplay video.mp4
ffplay music.mp3
</code></pre>
<p>(3)常用快捷键</p>
<p>按键&quot;Q&quot;或&quot;Esc&quot;：退出媒体播放<br>
键盘方向键：媒体播放的前进后退<br>
点击鼠标右键：拖动到该播放位置<br>
按键&quot;F&quot;：全屏<br>
按键&quot;P&quot;或空格键：暂停<br>
按键&quot;W&quot;:切换显示模式</p>
<p>(4)查看媒体参数信息</p>
<pre><code class="language-shell">ffprobe video.mp4
</code></pre>
<h3 id="03转换格式文件格式封装格式">03.转换格式(文件格式,封装格式)</h3>
<p>(1)文件名可以是中英文，但不能有空格。</p>
<p>(2)转换格式</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 video_avi.avi
</code></pre>
<h3 id="04改变编码-上编码音频转码">04.改变编码 上(编码,音频转码)</h3>
<p>(1)查看编解码器</p>
<pre><code class="language-shell">ffmpeg -codecs
</code></pre>
<p>(2)网站常用编码</p>
<p>MP4封装：H264视频编码+ACC音频编码<br>
WebM封装：VP8视频编码+Vorbis音频编码<br>
OGG封装：Theora视频编码+Vorbis音频编码</p>
<p>(3)无损编码格式.flac转换编码</p>
<pre><code class="language-shell">ffmpeg -i music_flac.flac -acodec libmp3lame -ar 44100 -ab 320k -ac 2 music_flac_mp3.mp3
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li>acodec:audio Coder Decoder 音频编码解码器</li>
<li>libmp3lame:mp3解码器</li>
<li>ar:audio rate：音频采样率</li>
<li>44100:设置音频的采样率44100。若不输入，默认用原音频的采样率</li>
<li>ab:audio bit rate 音频比特率</li>
<li>320k：设置音频的比特率。若不输入，默认128K</li>
<li>ac: aduio channels 音频声道</li>
<li>2:声道数。若不输入，默认采用源音频的声道数</li>
</ul>
<p>概括：设置格式的基本套路-先是指名属性，然后跟着新的属性值</p>
<p>(4)查看结果属性</p>
<pre><code class="language-shell">ffprobe music_flac_mp3.mp3
</code></pre>
<h3 id="05改变编码-中视频压制">05.改变编码 中(视频压制)</h3>
<p>(1)视频转码</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -s 1920x1080 -pix_fmt yuv420p -vcodec libx264 -preset medium -profile:v high -level:v 4.1 -crf 23 -acodec aac -ar 44100 -ac 2 -b:a 128k video_avi.avi
</code></pre>
<p><strong>说明:</strong></p>
<ul>
<li>-s 1920x1080：缩放视频新尺寸(size)</li>
<li>-pix_fmt yuv420p：pixel format,用来设置视频颜色空间。参数查询：ffmpeg -pix_fmts</li>
<li>-vcodec libx264：video Coder Decoder，视频编码解码器</li>
<li>-preset medium: 编码器预设。参数：ultrafast,superfast,veryfast,faster,fast,medium,slow,slower,veryslow,placebo</li>
<li>-profile:v high :编码器配置，与压缩比有关。实时通讯-baseline,流媒体-main,超清视频-high</li>
<li>-level:v 4.1 ：对编码器设置的具体规范和限制，权衡压缩比和画质。</li>
<li>-crf 23 ：设置码率控制模式。constant rate factor-恒定速率因子模式。范围0<sub>51,默认23。数值越小，画质越高。一般在8</sub>28做出选择。</li>
<li>-r 30 :设置视频帧率</li>
<li>-acodec aac :audio Coder Decoder-音频编码解码器</li>
<li>-b:a 128k :音频比特率.大多数网站限制音频比特率128k,129k<br>
其他参考上一个教程</li>
</ul>
<h3 id="06改变编码-下码率控制模式">06.改变编码 下(码率控制模式)</h3>
<p>ffmpeg支持的码率控制模式：-qp -crf -b</p>
<p>(1)  -qp :constant quantizer,恒定量化器模式</p>
<p>无损压缩的例子（快速编码）</p>
<pre><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset ultrafast -qp 0 output.mkv
</code></pre>
<p>无损压缩的例子（高压缩比）</p>
<pre><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow -qp 0 output.mkv
</code></pre>
<p>(2) -crf :constant rate factor,恒定速率因子模式</p>
<p>(3) -b ：bitrate,固定目标码率模式。一般不建议使用</p>
<p>3种模式默认单遍编码</p>
<p>VBR(Variable Bit Rate/动态比特率) 例子</p>
<pre><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow output
</code></pre>
<p>ABR(Average Bit Rate/平均比特率) 例子</p>
<pre><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow -b:v 3000k output
</code></pre>
<p>CBR(Constant Bit Rate/恒定比特率) 例子</p>
<pre><code class="language-shell">... -b:v 4000k -minrate 4000k -maxrate 4000k -bufsize 1835k ...
</code></pre>
<h3 id="07合并提取音视频">07.合并,提取音视频</h3>
<p>(1)单独提取视频（不含音频流）</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -vcodec copy -an video_silent.mp4
</code></pre>
<p>(2)单独提取音频（不含视频流）</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -vn -acodec copy video_novideo.m4a
</code></pre>
<p>具备多个音频流的，如</p>
<p>Stream #0:2[0x81]:Audio:ac3,48000Hz,5.1,s16,384kb/s<br>
Stream #0:3[0x82]:Audio:ac3,48000Hz,5.1,s16,384kb/s<br>
Stream #0:4[0x80]:Audio:ac3,48000Hz,5.1,s16,448kb/s</p>
<p>针对性的单一的提取，例如提取第2条，用指令： -map 0:3</p>
<p>(3)合并音视频</p>
<pre><code class="language-shell">ffmpeg -i video_novideo.m4a -i video_silent.mp4 -c copy video_merge.mp4
</code></pre>
<h3 id="08截取连接音视频">08.截取，连接音视频</h3>
<p>(1)截取</p>
<pre><code class="language-shell">ffmpeg -i music.mp3 -ss 00:00:30 -to 00:02:00 -acodec copy music_cutout.mp3
</code></pre>
<p>截取60秒</p>
<pre><code class="language-shell">ffmpeg -i music.mp3 -ss 00:00:30 -t 60 -acodec copy music_cutout60s.mp3
</code></pre>
<p>-sseof : 从媒体末尾开始截取</p>
<pre><code class="language-shell">ffmpeg -i in.mp4 -ss 00:01:00 -to 00:01:10 -c copy out.mp4
ffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy out.mp4
ffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy -copyts out.mp4
</code></pre>
<p>把-ss放到-i之前，启用了关键帧技术，加速操作。但截取的时间段不一定准确。可用最后一条指令，保留时间戳，保证时间准确。</p>
<p>(2)连接音视频</p>
<pre><code class="language-shell">ffmpeg -i &quot;concat:01.mp4|02.mp4|03.mp4&quot; -c copy out.mp4
</code></pre>
<p>不同格式的音视频可以连接在一起，但不推荐不同格式连接在一起。<br>
建议使用Avidemux软件连接</p>
<h3 id="09截图水印动图">09.截图,水印,动图</h3>
<p>(1)截图.</p>
<p>截取第7秒第1帧的画面</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -ss 7 -vframes 1 video_image.jpg
</code></pre>
<p>(2)水印</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -i qt.png -filter_complex &quot;overlay=20:80&quot; video_watermark.mp4
</code></pre>
<p>(3)截取动图</p>
<pre><code class="language-shell">ffmpeg -i video.mp4 -ss 7.5 -to 8.5 -s 640x320 -r 15 video_gif.gif
</code></pre>
<p>10.录屏,直播</p>
<p>(1)录屏</p>
<p>windows:</p>
<pre><code class="language-shell">ffmpeg -f gdigrab -i desktop rec.mp4
</code></pre>
<p>ubuntu:</p>
<pre><code class="language-shell">sudo ffmpeg -f fbdev -framerate 10 -i /dev/fb0 rec.mp4
</code></pre>
<p>gdigrab ：ffmpeg中的一个组件。</p>
<p>只捕获视频.若要录屏，录音，获取摄像头，麦克风，换组件，用OBS Studio软件</p>
<p>(2)直播</p>
<pre><code class="language-shell">ffmpeg -re i rec.mp4 按照网站要求编码 -f flv &quot;你的rtmp地址/你的直播码&quot;
</code></pre>
<h2 id="参考资料">参考资料</h2>
<p>笔记来源: https://www.bilibili.com/video/av40146374</p>
<p>官方教程: http://ffmpeg.org/ffmpeg-all.html</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://ydgros.github.io/post/wang-ke-wang-zhi/" class="post-title gt-a-link">
                    网课网址
                </a>
            </div>
        

        
            <span id="/post/ffmpeg-ming-ling/" class="leancloud_visitors" data-flag-title="ffmpeg命令">
                <em class="post-meta-item-text">阅读量 </em>
                <i class="leancloud-visitors-count">0</i>
            </span>
        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'rAhBAIVjWqOQ2rdtEY5AmKOl-MdYXbMMI',
		appKey: 'Hwis4q9LViKNwnXbQ4zGaxD7',
		avatar: '',
		pageSize: 5,
		recordIp: false,
		placeholder: 'Just Go Go',
		visitor: true,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">本站秉持互联网分享精神，采用网盘分享一些好用软件，希望大家遵守使用规则<br>
温馨提示：如不能流畅访问本站，建议开启UU加速器的学术资源加速
【 <a href="https://uu.163.com/" target="_blank">UU加速器</a>】</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://ydgros.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
